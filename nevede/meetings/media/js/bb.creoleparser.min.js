if(!Parse)var Parse={};if(!Parse.Simple)Parse.Simple={};Parse.Simple.Base=function(f,c){if(arguments.length){this.root=new this.ruleConstructor(f);this.options=c}};Parse.Simple.Base.prototype={ruleConstructor:null,root:null,options:null,parse:function(f,c,h){if(h)for(i in this.options){if(typeof h[i]=="undefined")h[i]=this.options[i]}else h=this.options;this.root.apply(f,c,h)}};Parse.Simple.Base.prototype.constructor=Parse.Simple.Base;
Parse.Simple.Base.Rule=function(f){if(arguments.length){for(var c in f)this[c]=f[c];if(!this.children)this.children=[]}};Parse.Simple.Base.prototype.ruleConstructor=Parse.Simple.Base.Rule;
Parse.Simple.Base.Rule.prototype={regex:null,capture:null,replaceRegex:null,replaceString:null,tag:null,attrs:null,children:null,match:function(f){return f.match(this.regex)},build:function(f,c,h){var a;if(this.capture!==null)a=c[this.capture];if(this.tag){c=document.createElement(this.tag);f.appendChild(c)}else c=f;if(a){if(this.replaceRegex)a=a.replace(this.replaceRegex,this.replaceString);this.apply(c,a,h)}if(this.attrs)for(var e in this.attrs){c.setAttribute(e,this.attrs[e]);if(e=="class")c.className=
this.attrs[e]}return this},apply:function(f,c,h){c=""+c;var a=[];if(!this.fallback.apply)this.fallback=new this.constructor(this.fallback);for(;;){for(var e=false,d=false,b=0;b<this.children.length;b++){if(typeof a[b]=="undefined"){this.children[b].match||(this.children[b]=new this.constructor(this.children[b]));a[b]=this.children[b].match(c,h)}if(a[b]&&(!e||e.index>a[b].index)){e=a[b];d=this.children[b];if(e.index==0)break}}b=e?e.index:c.length;b>0&&this.fallback.apply(f,c.substring(0,b),h);if(!e)break;
d.build||(d=new this.constructor(d));d.build(f,e,h);e=e.index+e[0].length;c=c.substring(e);for(b=0;b<this.children.length;b++)if(a[b])if(a[b].index>=e)a[b].index-=e;else a[b]=void 0}return this},fallback:{apply:function(f,c){f.appendChild(document.createTextNode(c))}}};Parse.Simple.Base.Rule.prototype.constructor=Parse.Simple.Base.Rule;
Parse.Simple.Creole=function(f){var c={};c.link="[^\\]|~\\n]*(?:(?:\\](?!\\])|~.)[^\\]|~\\n]*)*";c.linkText="[^\\]~\\n]*(?:(?:\\](?!\\])|~.)[^\\]~\\n]*)*";c.uriPrefix="\\b(?:(?:https?|ftp)://|mailto:)";c.uri=c.uriPrefix+c.link;c.rawUri=c.uriPrefix+"\\S*[^\\s!\"',.:;?]";c.interwikiPrefix="[\\w.]+:";c.interwikiLink=c.interwikiPrefix+c.link;var h=function(e,d){d=d instanceof Array?d:[d];if(typeof d[1]=="undefined")d[1]="";return d[0]+e+d[1]},a={hr:{tag:"hr",regex:/(^|\n)\s*----\s*(\n|$)/},br:{tag:"br",
regex:/\\\\/},preBlock:{tag:"pre",capture:2,regex:/(^|\n)\{\{\{\n((.*\n)*?)\}\}\}(\n|$)/,replaceRegex:/^ ([ \t]*\}\}\})/gm,replaceString:"$1"},tt:{tag:"tt",regex:/\{\{\{(.*?\}\}\}+)/,capture:1,replaceRegex:/\}\}\}$/,replaceString:""},ulist:{tag:"ul",capture:0,regex:/(^|\n)([ \t]*\*[^*#].*(\n|$)([ \t]*[^\s*#].*(\n|$))*([ \t]*[*#]{2}.*(\n|$))*)+/},olist:{tag:"ol",capture:0,regex:/(^|\n)([ \t]*#[^*#].*(\n|$)([ \t]*[^\s*#].*(\n|$))*([ \t]*[*#]{2}.*(\n|$))*)+/},li:{tag:"li",capture:0,regex:/[ \t]*([*#]).+(\n[ \t]*[^*#\s].*)*(\n[ \t]*\1[*#].+)*/,
replaceRegex:/(^|\n)[ \t]*[*#]/g,replaceString:"$1"},table:{tag:"table",capture:0,regex:/(^|\n)(\|.*?[ \t]*(\n|$))+/},tr:{tag:"tr",capture:2,regex:/(^|\n)(\|.*?)\|?[ \t]*(\n|$)/},th:{tag:"th",regex:/\|+=([^|]*)/,capture:1},td:{tag:"td",capture:1,regex:/\|+([^|~]*(~(.|(?=\n)|$)[^|~]*)*)/},singleLine:{regex:/.+/,capture:0},paragraph:{tag:"p",capture:0,regex:/(^|\n)([ \t]*\S.*(\n|$))+/},text:{capture:0,regex:/(^|\n)([ \t]*[^\s].*(\n|$))+/},strong:{tag:"strong",capture:1,regex:/\*\*([^*~]*((\*(?!\*)|~(.|(?=\n)|$))[^*~]*)*)(\*\*|\n|$)/},
em:{tag:"em",capture:1,regex:"\\/\\/(((?!"+c.uriPrefix+")[^\\/~])*(("+c.rawUri+"|\\/(?!\\/)|~(.|(?=\\n)|$))((?!"+c.uriPrefix+")[^\\/~])*)*)(\\/\\/|\\n|$)"},img:{regex:"\\{\\{((?!\\{)[^|}\\n]*(?:}(?!})[^|}\\n]*)*)\\|([^}~\\n]*((}(?!})|~.)[^}~\\n]*)*)}}",build:function(e,d){var b=document.createElement("img");b.src=d[1];b.alt=d[2].replace(/~(.)/g,"$1");e.appendChild(b)}},namedUri:{regex:"\\[\\[("+c.uri+")\\|("+c.linkText+")\\]\\]",build:function(e,d,b){var g=document.createElement("a");g.href=d[1];
b&&b.isPlainUri?g.appendChild(document.createTextNode(d[2])):this.apply(g,d[2],b);e.appendChild(g)}},namedLink:{regex:"\\[\\[("+c.link+")\\|("+c.linkText+")\\]\\]",build:function(e,d,b){var g=document.createElement("a");g.href=b&&b.linkFormat?h(d[1].replace(/~(.)/g,"$1"),b.linkFormat):d[1].replace(/~(.)/g,"$1");this.apply(g,d[2],b);e.appendChild(g)}},bb_user:{regex:"<<user (.+)>>",build:function(e,d){var b=document.createElement("a"),g=document.createTextNode(d[1]);b.href="/"+d[1];b.className="tooltip";
b.appendChild(g);e.appendChild(b)}},bb_cset:{regex:"<<(changeset|cset) (.+)>>",build:function(e,d){var b=document.createElement("a"),g=document.createTextNode("r123:"+d[2]);b.href="#";b.className="tooltip";b.appendChild(g);e.appendChild(b)}},bb_issue:{regex:"<<issue (\\d+)>>",build:function(e,d){var b=document.createElement("a"),g=document.createTextNode("#"+d[1]);b.href="#";b.className="tooltip";b.appendChild(g);e.appendChild(b)}},unnamedUri:{regex:"\\[\\[("+c.uri+")\\]\\]",build:"dummy"},unnamedLink:{regex:"\\[\\[("+
c.link+")\\]\\]",build:"dummy"},unnamedInterwikiLink:{regex:"\\[\\[("+c.interwikiLink+")\\]\\]",build:"dummy"},rawUri:{regex:"("+c.rawUri+")",build:"dummy"},escapedSequence:{regex:"~("+c.rawUri+"|.)",capture:1,tag:"span",attrs:{"class":"escaped"}},escapedSymbol:{regex:/~(.)/,capture:1,tag:"span",attrs:{"class":"escaped"}}};a.unnamedUri.build=a.rawUri.build=function(e,d,b){b||(b={});b.isPlainUri=true;a.namedUri.build.call(this,e,Array(d[0],d[1],d[1]),b)};a.unnamedLink.build=function(e,d,b){a.namedLink.build.call(this,
e,Array(d[0],d[1],d[1]),b)};a.namedInterwikiLink={regex:"\\[\\[("+c.interwikiLink+")\\|("+c.linkText+")\\]\\]",build:function(e,d,b){var g=document.createElement("a"),j,k;if(b&&b.interwiki){j=d[1].match(/(.*?):(.*)/);k=b.interwiki[j[1]]}if(typeof k=="undefined"){if(!a.namedLink.apply)a.namedLink=new this.constructor(a.namedLink);return a.namedLink.build.call(a.namedLink,e,d,b)}g.href=h(j[2].replace(/~(.)/g,"$1"),k);this.apply(g,d[2],b);e.appendChild(g)}};a.unnamedInterwikiLink.build=function(e,d,
b){a.namedInterwikiLink.build.call(this,e,Array(d[0],d[1],d[1]),b)};a.namedUri.children=a.unnamedUri.children=a.rawUri.children=a.namedLink.children=a.unnamedLink.children=a.namedInterwikiLink.children=a.unnamedInterwikiLink.children=[a.escapedSymbol,a.img];for(c=1;c<=6;c++)a["h"+c]={tag:"h"+c,capture:2,regex:"(^|\\n)[ \\t]*={"+c+"}[ \\t]([^~]*?(~(.|(?=\\n)|$))*)[ \\t]*=*\\s*(\\n|$)"};a.ulist.children=a.olist.children=[a.li];a.li.children=[a.ulist,a.olist];a.li.fallback=a.text;a.table.children=[a.tr];
a.tr.children=[a.th,a.td];a.td.children=[a.singleLine];a.th.children=[a.singleLine];a.h1.children=a.h2.children=a.h3.children=a.h4.children=a.h5.children=a.h6.children=a.singleLine.children=a.paragraph.children=a.text.children=a.strong.children=a.em.children=[a.escapedSequence,a.strong,a.em,a.br,a.rawUri,a.namedUri,a.namedInterwikiLink,a.namedLink,a.unnamedUri,a.unnamedInterwikiLink,a.unnamedLink,a.tt,a.img,a.bb_user,a.bb_cset,a.bb_issue];a.root={children:[a.h1,a.h2,a.h3,a.h4,a.h5,a.h6,a.hr,a.ulist,
a.olist,a.preBlock,a.table],fallback:{children:[a.paragraph]}};Parse.Simple.Base.call(this,a.root,f)};Parse.Simple.Creole.prototype=new Parse.Simple.Base;Parse.Simple.Creole.prototype.constructor=Parse.Simple.Creole;
